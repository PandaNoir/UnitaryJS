'use strict';(function(n,f){"object"===typeof exports&&"undefined"!==typeof module?module.exports=f():"function"===typeof define&&define.amd?define(f):n.Canvas=f()})(this,function(){function n(a){var b=a.target.getBoundingClientRect(),c=this.X(a.clientX-b.left),b=this.Y(a.clientY-b.top),d=!1;a.stopPropagation=function(){d=!0};for(var e=this.objects.length-1;0<=e&&!d;e--)this.objects[e].has&&this.objects[e].has(new Unitary.Point(c,b))&&this.objects[e].trigger(a.type,a)}function f(a){this.canvas.beginPath();
this.canvas.moveTo(this.X(a.points[0].x),this.Y(a.points[0].y));for(var b=0,c=a.points.length;b<c;b=0|b+1)this.canvas.lineTo(this.X(a.points[b].x),this.Y(a.points[b].y));this.canvas.lineTo(this.X(a.points[0].x),this.Y(a.points[0].y));this.canvas.closePath();this.canvas.stroke();null!==a.style.fillColor&&this.canvas.fill()}(function(){function a(a){this.value=a}function b(b){function d(h,g){try{var k=b[h](g),q=k.value;q instanceof a?Promise.resolve(q.value).then(function(a){d("next",a)},function(a){d("throw",
a)}):e(k.done?"return":"normal",k.value)}catch(r){e("throw",r)}}function e(a,b){switch(a){case "return":h.resolve({value:b,done:!0});break;case "throw":h.reject(b);break;default:h.resolve({value:b,done:!1})}(h=h.next)?d(h.key,h.arg):k=null}var h,k;this._invoke=function(a,b){return new Promise(function(c,e){var f={key:a,arg:b,resolve:c,reject:e,next:null};k?k=k.next=f:(h=k=f,d(a,b))})};"function"!==typeof b.return&&(this.return=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=
function(){return this});b.prototype.next=function(a){return this._invoke("next",a)};b.prototype.throw=function(a){return this._invoke("throw",a)};b.prototype.return=function(a){return this._invoke("return",a)};return{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}})();var t=function(){function a(a,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,
e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),l=[],m=function(a){console.log(a)},p=function(){function a(b){var c=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(null===document.getElementById(b)){if("complete"===document.readyState)throw Error("not found canvas.");this.ready=(new Promise(function(a){window.addEventListener("load",function(){a();console.log("loaded")})})).then(function(){var a=document.getElementById(b);c.canvas=
a.getContext("2d");c.element=a;c.canvasHeight=a.height;c.canvasWidth=a.width})}else{var d=document.getElementById(b);this.canvas=d.getContext("2d");this.element=d;this.ready=Promise.resolve();this.canvasHeight=d.height;this.canvasWidth=d.width}this.id=b;this.objects=[];this.mode="graph";this.origin=new Unitary.Point(0,0)}t(a,[{key:"listen",value:function(a){var c=this;this.ready.then(function(){c.element.addEventListener(a,n.bind(c),!1)})}},{key:"add",value:function(a){this.objects.push(a)}},{key:"removeAllObjects",
value:function(){this.objects=[]}},{key:"clear",value:function(){this.canvas.clearRect(0,0,this.canvasWidth,this.canvasHeight)}},{key:"X",value:function(a){return Math.round(a+this.origin.x)}},{key:"Y",value:function(a){var c=this.canvasHeight-(a+this.origin.y);"normal"===this.mode&&(c=a+this.origin.y);return Math.round(c)}},{key:"draw",value:function(){var a=this,c=[],d=function(a,b){c.push((new Promise(function(c,d){var g=void 0;l[a]?g=l[a]:(g=new Image,g.src=a,l[a]=g);g.loaded?(b.__image__=g,c()):
(g.addEventListener("load",function(){b.__image__=g;g.loaded=!0;c()}),g.addEventListener("error",d))})).catch(m))};(function h(a){for(var b=0,c=a.length;b<c;b=0|b+1){var f=a[b];"Image"===f.name()?f.__image__||d(f.src,f):"Group"===f.name()&&h(f.group)}})(this.objects);return Promise.all(c.concat(this.ready)).then(function(){for(var c=0,d=a.objects.length;c<d;c=0|c+1)a.__drawHelper__(a.objects[c])}).catch(m)}},{key:"__drawHelper__",value:function(b){var c=b.name();this.canvas.strokeStyle="#000";this.canvas.fillStyle=
"#000";b.style&&null!==b.style.fillColor&&(this.canvas.fillStyle=b.style.fillColor);b.style&&null!==b.style.strokeColor&&(this.canvas.strokeStyle=b.style.strokeColor);a.drawFunction[c].call(this,b)}},{key:"toDataURL",value:function(){return document.getElementById(this.id).toDataURL()}}]);return a}();Unitary.UnitaryObject.prototype.on=function(a,b){this.handlers||(this.handlers={});this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b);return this};Unitary.UnitaryObject.prototype.trigger=
function(a,b){if(!this.handlers||!this.handlers[a])return this;for(var c=0,d=this.handlers[a].length;c<d;c++)this.handlers[a][c](b);return this};p.drawFunction={Segment:function(a){this.canvas.beginPath();this.canvas.moveTo(this.X(a.points[0].x),this.Y(a.points[0].y));this.canvas.lineTo(this.X(a.points[1].x),this.Y(a.points[1].y));this.canvas.closePath();this.canvas.stroke()},Line:function(a){this.canvas.beginPath();0===a.b?(this.canvas.moveTo(this.X(-a.c),0),this.canvas.lineTo(this.X(-a.c),this.canvasHeight)):
(this.canvas.moveTo(0,this.Y(-(a.c/a.b))),this.canvas.lineTo(this.canvasWidth,this.Y(-(a.a*this.canvasWidth+a.c)/a.b)));this.canvas.closePath();this.canvas.stroke()},Circle:function(a){var b=a.center,c=a.r;this.canvas.beginPath();this.canvas.arc(this.X(b.x),this.Y(b.y),c,0,2*Math.PI,!1);this.canvas.closePath();this.canvas.stroke();null!==a.style.fillColor&&this.canvas.fill()},CircularSector:function(a){var b=a.center,c=a.r,d=a.startAngle,e=a.endAngle;this.canvas.beginPath();this.canvas.moveTo(this.X(b.x),
this.Y(b.y));this.canvas.arc(this.X(b.x),this.Y(b.y),c,d,e,!1);this.canvas.lineTo(this.X(b.x),this.Y(b.y));this.canvas.closePath();this.canvas.stroke();null!==a.style.fillColor&&this.canvas.fill()},Polygon:f,Quadrilateral:f,Triangle:f,Rect:function(a){var b=this.X(a.points[0].x),c=this.Y(a.points[0].y),d=a.points[1].x-a.points[0].x,e=a.points[1].y-a.points[0].y;"normal"!==this.mode&&(e=-(a.points[1].y-a.points[0].y));null!==a.style.fillColor?this.canvas.fillRect(b,c,d,e):this.canvas.strokeRect(b,
c,d,e)},Text:function(a){this.canvas.textAlign=a.style.align;this.canvas.textBaseline=a.style.baseline;var b=a.P.x,c=a.P.y,d=a.style.maxWidth,e=void 0;null!==a.style.font&&(e=this.canvas.font,this.canvas.font=a.style.font);null===d?(a.style.strokesOutline&&this.canvas.strokeText(a.text,this.X(b),this.Y(c)),this.canvas.fillText(a.text,this.X(b),this.Y(c))):(a.style.strokesOutline&&this.canvas.strokeText(a.text,this.X(b),this.Y(c),d),this.canvas.fillText(a.text,this.X(b),this.Y(c),d));null!==a.style.font&&
(this.canvas.font=e)},Point:function(a){this.canvas.fillRect(this.X(a.x),this.Y(a.y),1,1)},Image:function(a){var b=a.__image__;null!==a.dx&&null!==a.sx?this.canvas.drawImage(b,a.sx,a.sy,a.sw,a.sh,this.X(a.dx),this.Y(a.dy),a.dw,a.dh):null!==a.dx&&null===a.sx&&null!==a.dw?this.canvas.drawImage(b,this.X(a.dx),this.Y(a.dy),a.dw,a.dh):null!==a.dx&&null===a.dw?this.canvas.drawImage(b,this.X(a.dx),this.Y(a.dy)):null===a.dx&&this.canvas.drawImage(b)},Group:function(a){for(var b=0,c=a.group.length;b<c;b=0|
b+1)this.__drawHelper__(a.group[b])},Graph:function(a){this.canvas.beginPath();var b=a.start,c=a.end;null===b&&(b=-this.origin.x);null===c&&(c=this.canvasWidth-this.origin.x);for(var d=[];b<=c;b=0|b+1)d[d.length]=new Unitary.Point(b,a.f(b/a.scale)*a.scale);this.canvas.moveTo(this.X(d[0].x),this.Y(d[0].y));a=0;for(c=d.length;a<c;a=0|a+1)this.canvas.lineTo(this.X(d[a].x),this.Y(d[a].y)),this.canvas.moveTo(this.X(d[a].x),this.Y(d[a].y));this.canvas.moveTo(this.X(d[0].x),this.Y(d[0].y));this.canvas.closePath();
this.canvas.stroke()},BezierCurve:function(a){this.canvas.beginPath();var b=a.controlPoints,c=b,d=[],e=[b[0]];a=a.step;for(var h=0;1>h;h+=a){for(var c=b.concat(),f=0,l=b.length-1;f<l;f++){for(var g=0,m=c.length-1;g<m;g++)d[g]=new Unitary.Point(c[g+1].x*h+c[g].x*(1-h),c[g+1].y*h+c[g].y*(1-h));c=d;d=[]}e.push(c[0])}e.push(b[b.length-1]);this.canvas.moveTo(this.X(e[0].x),this.Y(e[0].y));b=0;for(c=e.length;b<c;b=0|b+1)this.canvas.lineTo(this.X(e[b].x),this.Y(e[b].y)),this.canvas.moveTo(this.X(e[b].x),
this.Y(e[b].y));this.canvas.moveTo(this.X(e[0].x),this.Y(e[0].y));this.canvas.closePath();this.canvas.stroke()}};p.preload=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];for(var d=[],a=function(a,c){var e=b[a];l[e]||d.push((new Promise(function(a,b){var c=new Image;c.src=e;c.addEventListener("load",function(){c.loaded=!0;a()});c.addEventListener("error",b);l[e]=c})).catch(m))},c=0,e=b.length;c<e;c++)a(c,e);return Promise.all(d).catch(m)};return p});
