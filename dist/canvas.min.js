'use strict';(function(q,h){"object"===typeof exports&&"undefined"!==typeof module?module.exports=h():"function"===typeof define&&define.amd?define(h):q.Canvas=h()})(this,function(){function q(a){var b=a.target.getBoundingClientRect(),d=this.X(a.clientX-b.left),b=this.Y(a.clientY-b.top),e=!1;a.stopPropagation=function(){e=!0};for(var f=this.objects.length-1;0<=f&&!e;f=0|f-1)this.objects[f].has&&this.objects[f].has(new Unitary.Point(d,b))&&this.objects[f].trigger(a.type,a)}function h(a){this.canvas.beginPath();
this.canvas.moveTo(this.X(a.points[0].x),this.Y(a.points[0].y));for(var b=0,d=a.points.length;b<d;b=0|b+1)this.canvas.lineTo(this.X(a.points[b].x),this.Y(a.points[b].y));this.canvas.lineTo(this.X(a.points[0].x),this.Y(a.points[0].y));this.canvas.closePath();this.canvas.stroke();null!==a.style.fillColor&&this.canvas.fill()}(function(){function a(a){this.value=a}function b(b){function e(g,p){try{var c=b[g](p),k=c.value;k instanceof a?Promise.resolve(k.value).then(function(a){e("next",a)},function(a){e("throw",
a)}):f(c.done?"return":"normal",c.value)}catch(r){f("throw",r)}}function f(a,b){switch(a){case "return":g.resolve({value:b,done:!0});break;case "throw":g.reject(b);break;default:g.resolve({value:b,done:!1})}(g=g.next)?e(g.key,g.arg):c=null}var g,c;this._invoke=function(a,b){return new Promise(function(d,f){var h={key:a,arg:b,resolve:d,reject:f,next:null};c?c=c.next=h:(g=c=h,e(a,b))})};"function"!==typeof b.return&&(this.return=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=
function(){return this});b.prototype.next=function(a){return this._invoke("next",a)};b.prototype.throw=function(a){return this._invoke("throw",a)};b.prototype.return=function(a){return this._invoke("return",a)};return{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}})();var t=function(){function a(a,d){for(var e=0;e<d.length;e++){var f=d[e];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,
f.key,f)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),m=[],n=function(a){console.log(a)},c=function(){function a(b){var d=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(null===document.getElementById(b)){if("complete"===document.readyState)throw Error("not found canvas.");this.ready=new Promise(function(a){window.addEventListener("load",function(){a()})})}else this.ready=Promise.resolve();this.ready.then(function(){var a=document.getElementById(b);
d.canvas=a.getContext("2d");d.element=a;d.canvasHeight=a.height;d.canvasWidth=a.width});this.id=b;this.objects=[];this.mode="graph";this.origin=new Unitary.Point(0,0)}t(a,[{key:"listen",value:function(a){var d=this;this.ready.then(function(){d.element.addEventListener(a,q.bind(d),!1)})}},{key:"add",value:function(a){this.objects[this.objects.length]=a}},{key:"removeAllObjects",value:function(){this.objects=[]}},{key:"clear",value:function(){var a=this;this.ready.then(function(){a.canvas.clearRect(0,
0,a.canvasWidth,a.canvasHeight)})}},{key:"X",value:function(a){return Math.round(a+this.origin.x)}},{key:"Y",value:function(a){return"normal"===this.mode?Math.round(a+this.origin.y):Math.round(this.canvasHeight-(a+this.origin.y))}},{key:"draw",value:function(){var a=this,d=[],e=function(a,b){d[d.length]=(new Promise(function(d,e){var c=void 0;m[a]?c=m[a]:(c=new Image,c.src=a,m[a]=c);c.loaded?(b.__image__=c,d()):(c.addEventListener("load",function(){b.__image__=c;c.loaded=!0;d()}),c.addEventListener("error",
e))})).catch(n)};(function g(a){for(var b=0,d=a.length;b<d;b=0|b+1){var c=a[b];"Image"===c.name()?c.__image__||e(c.src,c):"Group"===c.name()&&g(c.group)}})(this.objects);return Promise.all(d.concat(this.ready)).then(function(){for(var d=0,e=a.objects.length;d<e;d=0|d+1)a.__drawHelper__(a.objects[d])}).catch(n)}},{key:"__drawHelper__",value:function(b){var d=b.name();this.canvas.strokeStyle="#000";this.canvas.fillStyle="#000";b.style&&null!==b.style.fillColor&&(this.canvas.fillStyle=b.style.fillColor);
b.style&&null!==b.style.strokeColor&&(this.canvas.strokeStyle=b.style.strokeColor);a.painter[d].call(this,b)}},{key:"toDataURL",value:function(){return this.element.toDataURL()}}]);return a}();Unitary.UnitaryObject.prototype.on=function(a,b){this.handlers||(this.handlers={});this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b);return this};Unitary.UnitaryObject.prototype.trigger=function(a,b){if(!this.handlers||!this.handlers[a])return this;for(var d=0,e=this.handlers[a].length;d<e;d=
0|d+1)this.handlers[a][d](b);return this};c.painter={};c.painter.BezierCurve=function(a){this.canvas.beginPath();var b=a.controlPoints,d=b,e=[],c=a.points||[b[0]],g=1,h=a.step;if(!a.points){console.log("cache created");for(var l=0;1>l;l+=h){for(var d=b.concat(),p=0,m=b.length-1;p<m;p=0|p+1){for(var k=0,n=d.length-1;k<n;k=0|k+1)e[k]=new Unitary.Point(d[k+1].x*l+d[k].x*(1-l),d[k+1].y*l+d[k].y*(1-l));d=e;e=[]}c[g]=d[0];g=0|g+1}c[g]=b[b.length-1]}a.points=c;this.canvas.moveTo(this.X(c[0].x),this.Y(c[0].y));
a=0;for(b=c.length;a<b;a=0|a+1)this.canvas.lineTo(this.X(c[a].x),this.Y(c[a].y));this.canvas.moveTo(this.X(c[0].x),this.Y(c[0].y));this.canvas.closePath();this.canvas.stroke()};c.painter.Circle=function(a){var b=a.center,d=a.r;this.canvas.beginPath();this.canvas.arc(this.X(b.x),this.Y(b.y),d,0,2*Math.PI,!1);this.canvas.closePath();this.canvas.stroke();null!==a.style.fillColor&&this.canvas.fill()};c.painter.CircularSector=function(a){var b=a.center,d=a.r,c=a.startAngle,f=a.endAngle;this.canvas.beginPath();
this.canvas.moveTo(this.X(b.x),this.Y(b.y));this.canvas.arc(this.X(b.x),this.Y(b.y),d,c,f,!1);this.canvas.lineTo(this.X(b.x),this.Y(b.y));this.canvas.closePath();this.canvas.stroke();null!==a.style.fillColor&&this.canvas.fill()};c.painter.Graph=function(a){this.canvas.beginPath();var b=a.start,d=a.end;null===b&&(b=-this.origin.x);null===d&&(d=this.canvasWidth-this.origin.x);for(var c=[];b<=d;b=0|b+1)c[c.length]=new Unitary.Point(b,a.f(b/a.scale)*a.scale);this.canvas.moveTo(this.X(c[0].x),this.Y(c[0].y));
a=0;for(d=c.length;a<d;a=0|a+1)this.canvas.lineTo(this.X(c[a].x),this.Y(c[a].y)),this.canvas.moveTo(this.X(c[a].x),this.Y(c[a].y));this.canvas.moveTo(this.X(c[0].x),this.Y(c[0].y));this.canvas.closePath();this.canvas.stroke()};c.painter.Group=function(a){for(var b=0,d=a.group.length;b<d;b=0|b+1)this.__drawHelper__(a.group[b])};c.painter.Image=function(a){var b=a.__image__;null!==a.dx&&null!==a.sx?this.canvas.drawImage(b,a.sx,a.sy,a.sw,a.sh,this.X(a.dx),this.Y(a.dy),a.dw,a.dh):null!==a.dx&&null===
a.sx&&null!==a.dw?this.canvas.drawImage(b,this.X(a.dx),this.Y(a.dy),a.dw,a.dh):null!==a.dx&&null===a.dw?this.canvas.drawImage(b,this.X(a.dx),this.Y(a.dy)):null===a.dx&&this.canvas.drawImage(b)};c.painter.Line=function(a){this.canvas.beginPath();0===a.b?(this.canvas.moveTo(this.X(-a.c),0),this.canvas.lineTo(this.X(-a.c),this.canvasHeight)):(this.canvas.moveTo(0,this.Y(-(a.c/a.b))),this.canvas.lineTo(this.canvasWidth,this.Y(-(a.a*this.canvasWidth+a.c)/a.b)));this.canvas.closePath();this.canvas.stroke()};
c.painter.Point=function(a){this.canvas.fillRect(this.X(a.x),this.Y(a.y),1,1)};c.painter.Rect=function(a){var b=this.X(a.points[0].x),d=this.Y(a.points[0].y),c=a.points[1].x-a.points[0].x,f=a.points[1].y-a.points[0].y;"normal"!==this.mode&&(f=-(a.points[1].y-a.points[0].y));null!==a.style.fillColor?this.canvas.fillRect(b,d,c,f):this.canvas.strokeRect(b,d,c,f)};c.painter.Segment=function(a){this.canvas.beginPath();this.canvas.moveTo(this.X(a.points[0].x),this.Y(a.points[0].y));this.canvas.lineTo(this.X(a.points[1].x),
this.Y(a.points[1].y));this.canvas.closePath();this.canvas.stroke()};c.painter.Text=function(a){this.canvas.textAlign=a.style.align;this.canvas.textBaseline=a.style.baseline;var b=a.P.x,c=a.P.y,e=a.style.maxWidth,f=void 0;null!==a.style.font&&(f=this.canvas.font,this.canvas.font=a.style.font);null===e?(a.style.strokesOutline&&this.canvas.strokeText(a.text,this.X(b),this.Y(c)),this.canvas.fillText(a.text,this.X(b),this.Y(c))):(a.style.strokesOutline&&this.canvas.strokeText(a.text,this.X(b),this.Y(c),
e),this.canvas.fillText(a.text,this.X(b),this.Y(c),e));null!==a.style.font&&(this.canvas.font=f)};c.painter.Polygon=h;c.painter.Quadrilateral=h;c.painter.Triangle=h;c.preload=function(){for(var a=arguments,b=[],c=function(c,d){var e=a.length<=c?void 0:a[c];m[e]||(b[b.length]=(new Promise(function(a,b){var c=new Image;c.src=e;c.addEventListener("load",function(){c.loaded=!0;a()});c.addEventListener("error",b);m[e]=c})).catch(n))},e=0,f=arguments.length;e<f;e=0|e+1)c(e,f);return Promise.all(b).catch(n)};
return c});
