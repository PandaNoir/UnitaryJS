'use strict';(function(r,l){"object"===typeof exports&&"undefined"!==typeof module?module.exports=l():"function"===typeof define&&define.amd?define(l):r.Canvas=l()})(this,function(){function r(a){var b=a.target.getBoundingClientRect(),c=this.X(a.clientX-b.left),b=this.Y(a.clientY-b.top),c=new Unitary.Point(c,b),e=!1;a.stopPropagation=function(){e=!0};for(b=this.objects.length-1;0<=b&&!e;b=0|b-1)this.objects[b].has&&this.objects[b].has(c)&&this.objects[b].trigger(a.type,a)}function l(a){this.canvas.beginPath();
this.canvas.moveTo(this.X(a.points[0].x),this.Y(a.points[0].y));for(var b=0,c=a.points.length;b<c;b=0|b+1)this.canvas.lineTo(this.X(a.points[b].x),this.Y(a.points[b].y));this.canvas.closePath();null!==a.style.fillStyle&&this.canvas.fill();this.canvas.stroke()}(function(){function a(a){this.value=a}function b(b){function e(f,g){try{var d=b[f](g),q=d.value;q instanceof a?Promise.resolve(q.value).then(function(a){e("next",a)},function(a){e("throw",a)}):h(d.done?"return":"normal",d.value)}catch(k){h("throw",
k)}}function h(a,b){switch(a){case "return":f.resolve({value:b,done:!0});break;case "throw":f.reject(b);break;default:f.resolve({value:b,done:!1})}(f=f.next)?e(f.key,f.arg):g=null}var f,g;this._invoke=function(a,b){return new Promise(function(c,h){var d={key:a,arg:b,resolve:c,reject:h,next:null};g?g=g.next=d:(f=g=d,e(a,b))})};"function"!==typeof b.return&&(this.return=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this});b.prototype.next=
function(a){return this._invoke("next",a)};b.prototype.throw=function(a){return this._invoke("throw",a)};b.prototype.return=function(a){return this._invoke("return",a)};return{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}})();var t=function(){function a(a,c){for(var e=0;e<c.length;e++){var h=c[e];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,e){c&&a(b.prototype,
c);e&&a(b,e);return b}}(),m=[],p=function(a){console.log(a)},d=function(){function a(b){var c=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(null===document.getElementById(b)){if("complete"===document.readyState)throw Error("not found canvas.");this.ready=new Promise(function(a){return window.addEventListener("load",a)})}else this.ready=Promise.resolve();this.ready.then(function(){var a=document.getElementById(b);c.canvas=a.getContext("2d");c.element=a;c.canvasHeight=
a.height;c.canvasWidth=a.width});this.id=b;this.objects=[];this.mode="graph";this.origin=new Unitary.Point(0,0)}t(a,[{key:"listen",value:function(a){var c=this;this.ready.then(function(){return c.element.addEventListener(a,r.bind(c),!1)})}},{key:"add",value:function(a){this.objects[this.objects.length]=a}},{key:"removeAllObjects",value:function(){this.objects=[]}},{key:"clear",value:function(){var a=this;this.ready.then(function(){return a.canvas.clearRect(0,0,a.canvasWidth,a.canvasHeight)})}},{key:"X",
value:function(a){return Math.round(a+this.origin.x)}},{key:"Y",value:function(a){return"normal"===this.mode?Math.round(a+this.origin.y):Math.round(this.canvasHeight-(a+this.origin.y))}},{key:"draw",value:function(){var a=this,c=[],e=function(a,b){c[c.length]=(new Promise(function(c,e){var d=void 0;m[a]?d=m[a]:(d=new Image,d.src=a,m[a]=d);d.loaded?(b.__image__=d,c()):(d.addEventListener("load",function(){b.__image__=d;d.loaded=!0;c()}),d.addEventListener("error",e))})).catch(p)};(function f(a){for(var b=
0,c=a.length;b<c;b=0|b+1){var d=a[b];"Image"===d.name()?d.__image__||e(d.src,d):"Group"===d.name()&&f(d.group)}})(this.objects);return Promise.all(c.concat(this.ready)).then(function(){for(var c=0,e=a.objects.length;c<e;c=0|c+1)a.__drawHelper__(a.objects[c])}).catch(p)}},{key:"__drawHelper__",value:function(b){var c=b.name();this.canvas.strokeStyle="#000";this.canvas.fillStyle="#000";b.style&&null!==b.style.fillStyle&&(this.canvas.fillStyle=b.style.fillStyle);b.style&&null!==b.style.strokeStyle&&
(this.canvas.strokeStyle=b.style.strokeStyle);a.painter[c].call(this,b)}},{key:"toDataURL",value:function(){return this.element.toDataURL()}}]);return a}();Unitary.UnitaryObject.prototype.on=function(a,b){this.handlers||(this.handlers={});this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b);return this};Unitary.UnitaryObject.prototype.trigger=function(a,b){if(!this.handlers||!this.handlers[a])return this;for(var c=0,e=this.handlers[a].length;c<e;c=0|c+1)this.handlers[a][c](b);return this};
d.painter={};d.painter.BezierCurve=function(a){var b=this;this.canvas.beginPath();var c=a.controlPoints,e=c,d=[],f=a.points||[c[0]],g=1,l=a.step;if(!(1>=c.length)){if(2<=c.length&&4>=c.length)f=c.map(function(a){return{x:b.X(a.x),y:b.Y(a.y)}}),this.canvas.moveTo(f[0].x,f[0].y),2===f.length?this.canvas.lineTo(f[1].x,f[1].y):3===f.length?this.canvas.quadraticCurveTo(f[1].x,f[1].y,f[2].x,f[2].y):4===f.length&&this.canvas.bezierCurveTo(f[1].x,f[1].y,f[2].x,f[2].y,f[3].x,f[3].y);else{if(!a.points){for(var n=
0;1>n;n+=l){for(var e=c.concat(),m=0,q=c.length-1;m<q;m=0|m+1){for(var k=0,p=e.length-1;k<p;k=0|k+1)d[k]=new Unitary.Point(e[k+1].x*n+e[k].x*(1-n),e[k+1].y*n+e[k].y*(1-n));e=d;d=[]}f[g]=e[0];g=0|g+1}f[g]=c[c.length-1]}a.points=f;this.canvas.moveTo(this.X(f[0].x),this.Y(f[0].y));a=0;for(c=f.length;a<c;a=0|a+1)this.canvas.lineTo(this.X(f[a].x),this.Y(f[a].y))}this.canvas.stroke()}};d.painter.Circle=function(a){var b=a.center,c=a.r;this.canvas.beginPath();this.canvas.arc(this.X(b.x),this.Y(b.y),c,0,
2*Math.PI,a.anticlockwise);null!==a.style.fillStyle&&this.canvas.fill();this.canvas.stroke()};d.painter.CircularSector=function(a){var b=a.center,c=a.r,e=a.startAngle,d=a.endAngle;this.canvas.beginPath();this.canvas.moveTo(this.X(b.x),this.Y(b.y));this.canvas.arc(this.X(b.x),this.Y(b.y),c,e,d,a.anticlockwise);this.canvas.closePath();null!==a.style.fillStyle&&this.canvas.fill();this.canvas.stroke()};d.painter.Doughnut=function(a){var b=a.center,c=this.X(b.x),b=this.Y(b.y),e=a.innerRadius,d=a.outerRadius;
null!==a.style.fillStyle&&(this.canvas.beginPath(),this.canvas.arc(c,b,d,0,2*Math.PI,!1),this.canvas.arc(c,b,e,0,2*Math.PI,!0),this.canvas.fill());this.canvas.beginPath();this.canvas.arc(c,b,d,0,2*Math.PI,!1);this.canvas.stroke();this.canvas.beginPath();this.canvas.arc(c,b,e,0,2*Math.PI,!0);this.canvas.stroke()};d.painter.Graph=function(a){this.canvas.beginPath();var b=a.start,c=a.end;null===b&&(b=-this.origin.x);null===c&&(c=this.canvasWidth-this.origin.x);for(var e=[];b<=c;b=0|b+1)e[e.length]=new Unitary.Point(b,
a.f(b/a.scale)*a.scale);this.canvas.moveTo(this.X(e[0].x),this.Y(e[0].y));a=0;for(c=e.length;a<c;a=0|a+1)this.canvas.lineTo(this.X(e[a].x),this.Y(e[a].y)),this.canvas.moveTo(this.X(e[a].x),this.Y(e[a].y));this.canvas.closePath();this.canvas.stroke()};d.painter.Group=function(a){for(var b=0,c=a.group.length;b<c;b=0|b+1)this.__drawHelper__(a.group[b])};d.painter.Image=function(a){var b=a.__image__;null!==a.dx&&null!==a.sx?this.canvas.drawImage(b,a.sx,a.sy,a.sw,a.sh,this.X(a.dx),this.Y(a.dy),a.dw,a.dh):
null!==a.dx&&null===a.sx&&null!==a.dw?this.canvas.drawImage(b,this.X(a.dx),this.Y(a.dy),a.dw,a.dh):null!==a.dx&&null===a.dw?this.canvas.drawImage(b,this.X(a.dx),this.Y(a.dy)):null===a.dx&&this.canvas.drawImage(b)};d.painter.Line=function(a){var b=new Unitary.Segment(new Unitary.Point(0,0),new Unitary.Point(0,this.canvasHeight)),c=new Unitary.Segment(new Unitary.Point(this.canvasWidth,0),new Unitary.Point(this.canvasWidth,this.canvasHeight)),e=new Unitary.Segment(new Unitary.Point(0,0),new Unitary.Point(this.canvasWidth,
0)),d=new Unitary.Segment(new Unitary.Point(0,this.canvasHeight),new Unitary.Point(this.canvasWidth,this.canvasHeight)),f=null,g=null;b.intersects(a)&&(f=b.toLine().getIntersection(a));c.intersects(a)&&(g=c.toLine().getIntersection(a));e.intersects(a)&&d.intersects(a)?(g=e.toLine().getIntersection(a),a=d.toLine().getIntersection(a),g.x>a.x?(f=g,g=a):f=a):e.intersects(a)&&!d.intersects(a)?(a=e.toLine().getIntersection(a),null==f?f=a:g=a):!e.intersects(a)&&d.intersects(a)&&(a=d.toLine().getIntersection(a),
null==g?g=a:f=a);null!=f&&null!=g&&(this.canvas.beginPath(),this.canvas.moveTo(this.X(f.x),this.Y(f.y)),this.canvas.lineTo(this.X(g.x),this.Y(g.y)),this.canvas.stroke())};d.painter.Point=function(a){this.canvas.fillRect(this.X(a.x),this.Y(a.y),1,1)};d.painter.Rect=function(a){var b=this.X(a.points[0].x),c=this.Y(a.points[0].y),e=a.points[1].x-a.points[0].x,d=a.points[1].y-a.points[0].y;"normal"!==this.mode&&(d=-(a.points[1].y-a.points[0].y));null!==a.style.fillStyle?this.canvas.fillRect(b,c,e,d):
this.canvas.strokeRect(b,c,e,d)};d.painter.Segment=function(a){this.canvas.beginPath();this.canvas.moveTo(this.X(a.points[0].x),this.Y(a.points[0].y));this.canvas.lineTo(this.X(a.points[1].x),this.Y(a.points[1].y));this.canvas.stroke()};d.painter.Text=function(a){this.canvas.textAlign=a.style.align;this.canvas.textBaseline=a.style.baseline;var b=this.X(a.P.x),c=this.Y(a.P.y),e=a.style.maxWidth,d=void 0;null!==a.style.font&&(d=this.canvas.font,this.canvas.font=a.style.font);null===e?(a.style.strokesOutline&&
this.canvas.strokeText(a.text,b,c),this.canvas.fillText(a.text,b,c)):(a.style.strokesOutline&&this.canvas.strokeText(a.text,b,c,e),this.canvas.fillText(a.text,b,c,e));null!==a.style.font&&(this.canvas.font=d)};d.painter.Polygon=l;d.painter.Quadrilateral=l;d.painter.Triangle=l;d.preload=function(){for(var a=arguments,b=[],c=function(c,d){var e=a.length<=c?void 0:a[c];m[e]||(b[b.length]=(new Promise(function(a,b){var c=new Image;c.src=e;c.addEventListener("load",function(){c.loaded=!0;a()});c.addEventListener("error",
b);m[e]=c})).catch(p))},d=0,h=arguments.length;d<h;d=0|d+1)c(d,h);return Promise.all(b).catch(p)};return d});
